{"version":3,"file":"formy-entry.js","mappings":"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","sources":["webpack://Formy/webpack/universalModuleDefinition","webpack://Formy/webpack/bootstrap","webpack://Formy/webpack/runtime/define property getters","webpack://Formy/webpack/runtime/hasOwnProperty shorthand","webpack://Formy/webpack/runtime/make namespace object","webpack://Formy/./entry/index.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"Formy\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Formy\"] = factory();\n\telse\n\t\troot[\"Formy\"] = factory();\n})(self, function() {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","var JSSDK = [process.env.FORMY_CDN, process.env.FORMY_VERSION, \"formy-jssdk.js\"]\n    .filter(function (v) { return v; })\n    .join(\"/\");\nvar configs = [];\nvar Formy = function (config) {\n    configs.push(config);\n};\nvar formyInstances = [];\nfunction uuidv4() {\n    return \"\".concat(1e7, \"-\").concat(1e3, \"-\").concat(4e3, \"-\").concat(8e3, \"-\").concat(1e11).replace(/[018]/g, function (c) {\n        return (Number(c) ^\n            (crypto.getRandomValues(new Uint8Array(1))[0] & (15 >> (Number(c) / 4)))).toString(16);\n    });\n}\nvar IFrameEntry = /** @class */ (function () {\n    function IFrameEntry(config) {\n        this.config = config;\n        this.uuid = uuidv4();\n        formyInstances.push(this);\n    }\n    IFrameEntry.prototype.init = function () {\n        var _this = this;\n        var el = this.config.el;\n        if (!el) {\n            return;\n        }\n        var $iframe = document.createElement(\"iframe\");\n        var $target = document.querySelector(el);\n        $iframe.title = \"Formy\";\n        $iframe.frameBorder = \"0\";\n        $iframe.scrolling = \"no\";\n        $iframe.width = \"100%\";\n        if (!$target) {\n            return;\n        }\n        $iframe.onload = function () {\n            _this.appendElements($iframe);\n            _this.appendBase($iframe);\n            _this.appendScripts($iframe);\n            _this.resizeObserver($iframe);\n        };\n        $target.replaceChildren($iframe);\n    };\n    IFrameEntry.prototype.appendElements = function ($iframe) {\n        var $body = $iframe.contentWindow.document.body;\n        var $root = document.createElement(\"div\");\n        $root.id = \"root\";\n        $body.appendChild($root);\n    };\n    IFrameEntry.prototype.appendScripts = function ($iframe) {\n        var $head = $iframe.contentWindow.document.head;\n        var $scriptFile = document.createElement(\"script\");\n        $scriptFile.src = JSSDK;\n        $scriptFile.onerror = function () {\n            // TODO: report to sentry\n            console.error(\"formy sdk script load failed!\");\n        };\n        var $script = document.createElement(\"script\");\n        var $inlineText = document.createTextNode(\"\\nfunction initFormy(Formy) {\\n  const instance = parent.window.Formy.instances.find((ins) => {\\n    return ins.uuid === '\".concat(this.uuid, \"';\\n  });\\n  var config = Object.assign({}, instance.config, {el: \\\"#root\\\"})\\n  new Formy(config);\\n}\\n      \"));\n        $script.appendChild($inlineText);\n        $head.append($script);\n        $head.appendChild($scriptFile);\n    };\n    IFrameEntry.prototype.appendBase = function ($iframe) {\n        var $head = $iframe.contentWindow.document.head;\n        var $base = document.createElement(\"base\");\n        $base.href = window.location.href;\n        $head.appendChild($base);\n    };\n    IFrameEntry.prototype.resizeObserver = function ($iframe) {\n        var setHeight = function (height) {\n            if ($iframe) {\n                $iframe.height = height;\n            }\n        };\n        var $body = $iframe.contentWindow.document.body;\n        var ob = new ResizeObserver(function (entries) {\n            window.requestAnimationFrame(function () {\n                if (!Array.isArray(entries) || !entries.length) {\n                    return;\n                }\n                var bodyHeight = entries[0].target.scrollHeight;\n                setHeight(bodyHeight.toString());\n            });\n        });\n        ob.observe($body);\n    };\n    return IFrameEntry;\n}());\nvar InlineEntry = /** @class */ (function () {\n    function InlineEntry(config) {\n        this.config = config;\n        this.uuid = uuidv4();\n        formyInstances.push(this);\n    }\n    InlineEntry.prototype.init = function () {\n        var _this = this;\n        var el = this.config.el;\n        if (!el) {\n            return;\n        }\n        this.loadScript(function () {\n            // call JSSDK\n            new window.FormySDK.API(_this.config);\n        });\n    };\n    InlineEntry.prototype.loadScript = function (onLoadSuccess) {\n        // check if JSSDK loaded\n        if (!window.FormySDK) {\n            var $head = document.head;\n            var $script = document.createElement(\"script\");\n            $script.onload = function () { return onLoadSuccess === null || onLoadSuccess === void 0 ? void 0 : onLoadSuccess(); };\n            $script.src = JSSDK;\n            $head.appendChild($script);\n        }\n        else {\n            onLoadSuccess === null || onLoadSuccess === void 0 ? void 0 : onLoadSuccess();\n        }\n    };\n    return InlineEntry;\n}());\nvar FormyEntry = /** @class */ (function () {\n    function FormyEntry(config) {\n        if (config.mode === \"inline\") {\n            this.entry = new InlineEntry(config);\n        }\n        else {\n            this.entry = new IFrameEntry(config);\n        }\n    }\n    FormyEntry.prototype.init = function () {\n        var _a;\n        (_a = this.entry) === null || _a === void 0 ? void 0 : _a.init();\n    };\n    return FormyEntry;\n}());\nvar initConfigs = function () {\n    configs.forEach(function (config) {\n        var entry = new FormyEntry(config);\n        entry.init();\n    });\n};\nif (document.readyState !== \"complete\") {\n    document.onreadystatechange = function () {\n        if (document.readyState === \"complete\") {\n            initConfigs();\n        }\n    };\n}\nelse {\n    initConfigs();\n}\nexport var init = Formy;\nexport var instances = formyInstances;\nexport var entry = FormyEntry;\n"],"names":["root","factory","exports","module","define","amd","self","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","JSSDK","filter","v","join","configs","formyInstances","uuidv4","concat","replace","c","Number","crypto","getRandomValues","Uint8Array","toString","IFrameEntry","config","this","uuid","push","init","_this","el","$iframe","document","createElement","$target","querySelector","title","frameBorder","scrolling","width","onload","appendElements","appendBase","appendScripts","resizeObserver","replaceChildren","$body","contentWindow","body","$root","id","appendChild","$head","head","$scriptFile","src","onerror","console","error","$script","$inlineText","createTextNode","append","$base","href","window","location","ResizeObserver","entries","requestAnimationFrame","height","Array","isArray","length","target","scrollHeight","observe","InlineEntry","loadScript","FormySDK","API","onLoadSuccess","FormyEntry","mode","entry","_a","initConfigs","forEach","readyState","onreadystatechange","instances"],"sourceRoot":""}